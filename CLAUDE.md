# Claude 使用说明

在本项目中，请 Claude 遵循以下要求：

- 所有文档与代码注释使用中文。
- 输出采用 Markdown 标题、列表与代码块，结构清晰、层次分明。
- 编写或修改代码时，遵循下文《OpenList-STRM 项目开发指南》的规范。
- 回答保持简洁；遇到复杂问题需给出必要的背景、步骤与示例。
- 进行提交操作时，请遵循 Git 提交规范（feat / fix / test / refactor / docs / perf 等）。

## 文件创建规范
⚠️ **重要：禁止随意创建文件**
- **不要主动创建**：测试文件、文档文件、配置文件等
- **不要瞎创建目录**：禁止创建新目录，所有文件应放在现有目录结构中
- **用代码块展示**：默认通过代码块展示内容，不创建实际文件
- **等待明确指令**：只有用户明确说"创建文件"或"写入文件"时才创建
- **询问确认**：如果不确定是否需要创建文件，先询问用户

示例：
- 用户："我需要一个测试脚本" → 用代码块展示脚本内容
- 用户："创建一个test.sh文件" → 创建实际文件

## Git提交规范
⚠️ **重要：禁止主动提交**
- **不要主动提交git**：禁止自行决定git commit
- **询问许可**：当完成一定功能后，询问："已完成xxx功能，是否可以进行git提交？"
- **等待决定**：由用户决定是否进行提交
- **提交信息规范**：获得许可后，使用规范的提交信息格式

## 测试文件规范
⚠️ **重要：禁止随意创建测试**
- **不要乱创建测试文件**：禁止随意创建测试脚本或测试文件
- **说明并询问**：需要测试时，先说明测试目的和功能，询问是否可以创建
- **等待批准**：只有获得明确批准后才能创建测试文件
- **指定位置**：测试脚本统一放在 docs/ 目录

---

# OpenList-STRM 项目开发指南

## 项目基本信息

### 技术栈
- **后端**: Go 1.23 + Gin + SQLite + Gorm
- **前端**: Vue 3 + Vite + Element Plus
- **定时任务**: Cron
- **数据库**: SQLite

### 目录结构
```
├── backend/          # Go 后端（主要开发目录）
├── web/              # Vue 3 前端
├── configs/          # 配置文件
├── deployments/      # Docker 部署文件
└── docs/             # 项目文档
```

详细的项目结构和开发流程请参考 [docs/README.md](./docs/README.md) 或 PRD 文档。

---

## 开发规范

### Git 提交规范
- `feat:` 新功能
- `fix:` 修复问题
- `perf:` 性能优化
- `refactor:` 重构
- `test:` 测试相关
- `docs:` 文档更新

### 提交时机（需询问）
在以下情形完成后应询问是否提交：
- 完成功能模块
- 修复重要 bug
- 添加测试用例
- 重构代码

### 提交前检查（必须全部满足）
- [ ] **代码格式化**：Go代码必须先运行 `gofmt -w .` 格式化（在 backend 目录下）
- [ ] **编译通过**：`go build ./...` 必须无错误（在 backend 目录下）
- [ ] **代码质量检查**：`golangci-lint run --timeout=5m` 必须无错误（在 backend 目录下）
- [ ] **所有测试通过**：运行所有测试文件，确保100%通过
  - Go后端：`cd backend && go test -v -cover ./...`
  - Vue前端：`cd web && npm run build` 确保构建成功
- [ ] 功能正常运行
- [ ] 提交信息符合规范

⚠️ **重要**：
- **Go代码格式化规范**：每次提交Go代码前必须在 backend 目录下运行 `gofmt -w .` 格式化所有文件！
- **代码质量检查必须通过**：每次提交前必须在 backend 目录下运行 `golangci-lint run --timeout=5m` 确保无错误！
- 必须先编译成功，确认无报错后才能提交！未编译通过的代码禁止提交！
- **每次提交前必须运行所有相关测试**，确保所有测试用例都通过！
- 修改任何代码后，都要运行对应的测试文件验证修改的正确性！

### golangci-lint 安装

```bash
# 使用官方脚本安装 v1.64.8（与 GitHub CI 保持一致）
mkdir -p ~/bin
curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b ~/bin v1.64.8

# 验证安装
~/bin/golangci-lint --version
# 应输出: golangci-lint has version 1.64.8

# 运行检查（在 backend 目录下）
cd backend
~/bin/golangci-lint run --timeout=5m
```

---

## 开发协作流程

### 需求实施标准流程
在接到任何开发需求时，必须遵循以下流程：

1. **理解分析**：仔细理解需求，识别关键点和潜在问题
2. **澄清确认**：有任何疑问必须问清楚，确认理解无误
3. **方案确认**：提出实现方案并征求同意："理解无误，是否可以开始实现？"
4. **开始实施**：只有在得到明确许可后才开始编码

⚠️ **重要原则**：
- 禁止在理解不清或未经确认的情况下直接编码
- 遇到新问题或需求变更时，重新走确认流程
- 宁可多问一句，不要做错返工

---

## 文档管理规范

### 统一文档结构
项目已建立统一的文档体系，必须严格遵循：

```
├── README.md           # 项目主页（唯一入口）
├── CLAUDE.md           # Claude 开发指南（本文件）
└── docs/               # 统一文档中心
    ├── PRD.md          # 产品需求文档
    ├── TESTING.md      # 测试计划文档
    └── README.md       # 文档索引
```

### 文档创建原则
⚠️ **严格禁止**：
- 创建重复性质的文档文件
- 在多个目录下分散存放文档
- 创建临时性或实验性文档文件
- 创建单一功能的独立文档

✅ **必须遵循**：
- 所有文档更新只在现有文件中进行
- 新内容优先合并到相关现有文档
- 保持文档数量最小化，内容最大化
- 删除过时或重复的文档内容

### 文档更新流程
1. **更新前评估**：确认内容是否可合并到现有文档
2. **选择目标文档**：根据内容性质选择合适的现有文档
3. **合并更新**：将新内容整合到目标文档中
4. **清理重复**：删除任何重复或过时的内容
5. **更新链接**：确保所有引用链接正确

### 文档维护责任
- 每次文档修改必须同时更新相关联的其他文档
- 定期检查文档间的一致性和链接有效性
- 禁止创建"临时文档"，所有文档都应是正式文档

---

## 重要提醒
- 不要硬编码敏感信息
- 保持代码简洁，避免过度设计
- 优先修复现有代码而非创建新文件
- 以测试驱动开发（TDD）保证代码质量
- **严格控制文档数量，避免文档碎片化**
