# OpenList-STRM

OpenList-STRM æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„ STRM æ–‡ä»¶ç”Ÿæˆå·¥å…·ï¼Œç”¨äºå°† Alist ç½‘ç›˜ä¸­çš„åª’ä½“æ–‡ä»¶æ‰¹é‡ç”Ÿæˆä¸º STRM æ ¼å¼ï¼Œä¾› Embyã€Jellyfinã€Plex ç­‰æµåª’ä½“æœåŠ¡å™¨ä½¿ç”¨ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**ï¼šGo è¯­è¨€å®ç°ï¼Œå¹¶å‘å¤„ç†ï¼Œæ€§èƒ½ä¼˜äº Python å®ç°
- ğŸ’¾ **å…æŒ‚è½½**ï¼šæ— éœ€æŒ‚è½½ç½‘ç›˜ï¼Œé€šè¿‡ STRM æ–‡ä»¶ç›´æ¥æ’­æ”¾
- ğŸ“¦ **èŠ‚çœç©ºé—´**ï¼šæœ¬åœ°åªå­˜å‚¨å°ä½“ç§¯çš„ STRM æ–‡ä»¶
- â° **çµæ´»è°ƒåº¦**ï¼šæ¯ä¸ªé…ç½®ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡ï¼Œå¯è§†åŒ– Cron ç¼–è¾‘å™¨
- ğŸ”„ **å¢é‡æ›´æ–°**ï¼šæ™ºèƒ½å¢é‡åŒæ­¥ï¼Œåªå¤„ç†æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶
- ğŸ¯ **ç®€å•æ˜“ç”¨**ï¼šå•äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²ï¼ŒWeb UI å¯è§†åŒ–é…ç½®
- ğŸŒ **Web UI**ï¼šç°ä»£åŒ– Vue 3 ç•Œé¢ï¼Œæ— éœ€ç¼–è¾‘é…ç½®æ–‡ä»¶
- ğŸ”Œ **API æ¥å£**ï¼šRESTful APIï¼Œæ”¯æŒå¤–éƒ¨ç¨‹åºè°ƒç”¨
- ğŸ¬ **MediaWarp æ”¯æŒ**ï¼šæ”¯æŒ 302 é‡å®šå‘ä»£ç†ï¼Œä¼˜åŒ–æ’­æ”¾ä½“éªŒ
- ğŸ”” **è‡ªåŠ¨é€šçŸ¥**ï¼šæ”¯æŒ Emby/Jellyfin è‡ªåŠ¨æ‰«æï¼Œæ— ç¼æ›´æ–°åª’ä½“åº“

## ğŸ“‹ å½“å‰ç‰ˆæœ¬

**v1.0.0** - å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬

å·²å®ç°åŠŸèƒ½ï¼š
- âœ… Alist API é›†æˆ
- âœ… STRM æ–‡ä»¶ç”Ÿæˆï¼ˆæ”¯æŒ alist_path å’Œ http_url ä¸¤ç§æ¨¡å¼ï¼‰
- âœ… å¢é‡/å…¨é‡æ›´æ–°æ¨¡å¼
- âœ… **æ¯é…ç½®ç‹¬ç«‹å®šæ—¶ä»»åŠ¡**ï¼ˆå¯è§†åŒ– Cron ç¼–è¾‘å™¨ï¼‰
- âœ… SQLite æ•°æ®å­˜å‚¨
- âœ… æ¯é…ç½®ç‹¬ç«‹å¹¶å‘æ§åˆ¶ï¼ˆé˜²é£æ§ï¼‰
- âœ… æ—¥å¿—ç³»ç»Ÿ
- âœ… **RESTful API æ¥å£**ï¼ˆå®Œæ•´çš„ CRUD æ“ä½œï¼‰
- âœ… **Vue 3 Web UI ç®¡ç†ç•Œé¢**ï¼ˆæ•°æ®åº“é…ç½®ç®¡ç†ï¼‰
- âœ… **Webhook æ”¯æŒ**ï¼ˆè‡ªåŠ¨è§¦å‘ä»»åŠ¡ï¼‰
- âœ… **Docker éƒ¨ç½²**
- âœ… **MediaWarp é›†æˆæ”¯æŒ**
- âœ… **åª’ä½“æœåŠ¡å™¨é€šçŸ¥**ï¼ˆæ”¯æŒ Emby/Jellyfin è‡ªåŠ¨æ‰«æï¼‰

å¾…å®ç°åŠŸèƒ½ï¼ˆåç»­ç‰ˆæœ¬ï¼‰ï¼š
- â³ å…ƒæ•°æ®ä¸‹è½½
- â³ æ–‡ä»¶æœ‰æ•ˆæ€§æ£€æµ‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½

```bash
# ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆç¼–è¯‘åï¼‰
# æˆ–è€…ä»æºç ç¼–è¯‘
git clone https://github.com/konghang/openlist-strm.git
cd openlist-strm
make build
```

### 2. é…ç½®

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶ç¤ºä¾‹
cp configs/config.example.yaml config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim config.yaml
```

**æœ€å°é…ç½®**ï¼š

```yaml
# æœåŠ¡å™¨é…ç½®
server:
  host: "0.0.0.0"
  port: 8080

# Alist é…ç½®ï¼ˆå¿…éœ€ï¼‰
alist:
  url: "http://your-alist-url:5244"
  token: "your-alist-token"
  sign_enabled: false
  timeout: 30

# æ•°æ®åº“é…ç½®
database:
  path: "./data/openlist-strm.db"

# æ—¥å¿—é…ç½®
log:
  level: "info"
  file: ""  # ç•™ç©ºåˆ™è¾“å‡ºåˆ° stdoutï¼ˆDocker æ¨èï¼‰
            # è®¾ç½®è·¯å¾„åˆ™è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¦‚ "./logs/openlist-strm.log"
```

**æ³¨æ„**ï¼šè·¯å¾„æ˜ å°„ï¼ˆmappingsï¼‰ç°åœ¨é€šè¿‡ Web UI ç®¡ç†ï¼Œä¸å†åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚

### 3. è¿è¡Œ

```bash
./bin/openlist-strm -config config.yaml
```

### 4. è®¿é—® Web UI

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® Web ç®¡ç†ç•Œé¢ï¼š

```
http://localhost:8080
```

Web UI æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- ğŸ“Š **ä»ªè¡¨ç›˜**ï¼šæŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ã€å¿«é€Ÿæ“ä½œã€æœ€è¿‘ä»»åŠ¡
- ğŸ“‹ **ä»»åŠ¡ç®¡ç†**ï¼šæŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ã€æ‰§è¡ŒçŠ¶æ€ã€è¯¦ç»†ä¿¡æ¯
- âš™ï¸ **é…ç½®ç®¡ç†**ï¼š
  - åˆ›å»º/ç¼–è¾‘/åˆ é™¤è·¯å¾„æ˜ å°„
  - é…ç½®è§†é¢‘æ‰©å±•åã€å¹¶å‘æ•°ã€æ›´æ–°æ¨¡å¼
  - é€‰æ‹© STRM æ¨¡å¼ï¼ˆAlist è·¯å¾„æˆ–ç›´é“¾ URLï¼‰
  - å¯è§†åŒ– Cron ç¼–è¾‘å™¨ï¼Œè®¾ç½®ç‹¬ç«‹å®šæ—¶ä»»åŠ¡
  - æŸ¥çœ‹æœ€è¿‘ä¸‰æ¬¡æ‰§è¡Œæ—¶é—´é¢„è§ˆ
  - æ‰‹åŠ¨è§¦å‘ç”Ÿæˆä»»åŠ¡

## ğŸ“– é…ç½®è¯´æ˜

### Alist é…ç½®

```yaml
alist:
  url: "http://localhost:5244"  # Alist æœåŠ¡åœ°å€
  token: "your-alist-token"     # Alist API Token
  sign_enabled: false           # æ˜¯å¦å¯ç”¨ç­¾å
  timeout: 30                   # è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
```

### è·¯å¾„æ˜ å°„é…ç½®

**è·¯å¾„æ˜ å°„ç°åœ¨é€šè¿‡ Web UI ç®¡ç†**ï¼Œä¸å†åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚

åœ¨ Web UI ä¸­åˆ›å»ºé…ç½®æ—¶ï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| é…ç½®åç§° | æ˜ å°„çš„æ ‡è¯†åç§° | `Movies` |
| æºè·¯å¾„ | Alist ä¸­çš„è·¯å¾„ | `/media/movies` |
| ç›®æ ‡è·¯å¾„ | æœ¬åœ° STRM æ–‡ä»¶ä¿å­˜è·¯å¾„ | `/mnt/strm/movies` |
| è§†é¢‘æ‰©å±•å | éœ€è¦å¤„ç†çš„è§†é¢‘æ ¼å¼ | `mp4, mkv, avi, mov` |
| å¹¶å‘æ•° | åŒæ—¶å¤„ç†çš„æ–‡ä»¶æ•°é‡ | `3`ï¼ˆæ¨è 1-5ï¼Œé˜²é£æ§ï¼‰ |
| æ›´æ–°æ¨¡å¼ | å¢é‡æˆ–å…¨é‡ | `incremental` / `full` |
| STRM æ¨¡å¼ | è·¯å¾„æˆ–ç›´é“¾ | `alist_path` / `http_url` |
| å®šæ—¶ä»»åŠ¡ | Cron è¡¨è¾¾å¼ï¼ˆå¯é€‰ï¼‰ | `0 2 * * *` |
| å¯ç”¨çŠ¶æ€ | æ˜¯å¦å¯ç”¨æ­¤é…ç½® | `true` / `false` |

### STRM æ¨¡å¼è¯´æ˜

**alist_path æ¨¡å¼**ï¼ˆæ¨èæ­é… MediaWarpï¼‰ï¼š
- STRM æ–‡ä»¶å†…å®¹ä¸º Alist è·¯å¾„ï¼š`/media/movies/movie.mp4`
- éœ€è¦é…åˆ [MediaWarp](https://github.com/AkimioJR/MediaWarp) ä½¿ç”¨
- MediaWarp è´Ÿè´£ 302 é‡å®šå‘è·å–å®é™…æ’­æ”¾é“¾æ¥
- ä¼˜ç‚¹ï¼šæ”¯æŒ Alist ç­¾åã€CDN åˆ‡æ¢ç­‰é«˜çº§åŠŸèƒ½

**http_url æ¨¡å¼**ï¼ˆç›´æ¥æ’­æ”¾ï¼‰ï¼š
- STRM æ–‡ä»¶å†…å®¹ä¸ºå®Œæ•´ URLï¼š`http://alist.example.com/d/media/movies/movie.mp4`
- ç›´æ¥æ’­æ”¾ï¼Œæ— éœ€é¢å¤–ç»„ä»¶
- é€‚åˆç®€å•åœºæ™¯

### å®šæ—¶ä»»åŠ¡é…ç½®

**æ¯ä¸ªé…ç½®å¯ä»¥æœ‰ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡**ï¼Œé€šè¿‡ Web UI çš„å¯è§†åŒ–ç¼–è¾‘å™¨è®¾ç½®ï¼š

**é¢„è®¾æ¨¡å¼**ï¼š
- æ¯éš” N åˆ†é’Ÿï¼ˆ5/10/15/20/30 åˆ†é’Ÿï¼‰
- æ¯å°æ—¶ï¼ˆå¯æŒ‡å®šåˆ†é’Ÿæ•°ï¼‰
- æ¯å¤©ï¼ˆæ—¶é—´é€‰æ‹©å™¨ï¼‰
- æ¯å‘¨ï¼ˆé€‰æ‹©æ˜ŸæœŸ + æ—¶é—´ï¼‰
- æ¯æœˆï¼ˆé€‰æ‹©æ—¥æœŸ + æ—¶é—´ï¼‰
- è‡ªå®šä¹‰è¡¨è¾¾å¼

**Cron è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š
- `*/30 * * * *` - æ¯ 30 åˆ†é’Ÿ
- `0 * * * *` - æ¯å°æ—¶æ•´ç‚¹
- `0 2 * * *` - æ¯å¤©å‡Œæ™¨ 2 ç‚¹
- `0 2 * * 0` - æ¯å‘¨æ—¥å‡Œæ™¨ 2 ç‚¹
- `0 2 1 * *` - æ¯æœˆ 1 å·å‡Œæ™¨ 2 ç‚¹

**æ‰§è¡Œæ—¶é—´é¢„è§ˆ**ï¼š
- ç¼–è¾‘å™¨ä¼šå®æ—¶æ˜¾ç¤ºæœ€è¿‘ä¸‰æ¬¡æ‰§è¡Œæ—¶é—´
- å¸®åŠ©éªŒè¯ Cron è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®

### API é…ç½®

```yaml
api:
  enabled: true
  token: ""  # å¯é€‰ï¼Œç•™ç©ºåˆ™ä¸éœ€è¦è®¤è¯
  timeout: 300
```

### Web UI é…ç½®

```yaml
web:
  enabled: true
  username: "admin"      # ä¿ç•™å­—æ®µï¼Œå½“å‰ç‰ˆæœ¬æœªä½¿ç”¨
  password: "admin123"   # ä¿ç•™å­—æ®µï¼Œå½“å‰ç‰ˆæœ¬æœªä½¿ç”¨
```

### åª’ä½“æœåŠ¡å™¨é€šçŸ¥é…ç½®

OpenList-STRM æ”¯æŒåœ¨ç”Ÿæˆ STRM æ–‡ä»¶åè‡ªåŠ¨é€šçŸ¥ Emby æˆ– Jellyfin æ‰«æåª’ä½“åº“ï¼Œå®ç°è‡ªåŠ¨æ›´æ–°åª’ä½“åº“å†…å®¹ã€‚

```yaml
media_server:
  enabled: false  # æ˜¯å¦å¯ç”¨åª’ä½“æœåŠ¡å™¨é€šçŸ¥
  type: "emby"    # åª’ä½“æœåŠ¡å™¨ç±»å‹: emby, jellyfin, both

  # Emby é…ç½®
  emby:
    url: "http://emby:8096"        # Emby æœåŠ¡å™¨åœ°å€
    api_key: "your-emby-api-key"   # Emby API Key
    scan_mode: "full"              # æ‰«ææ¨¡å¼: full=å…¨åº“æ‰«æ, path=è·¯å¾„æ‰«æ
    # è·¯å¾„æ˜ å°„é…ç½®ï¼ˆä»…åœ¨ scan_mode=path æ—¶éœ€è¦ï¼‰
    path_mapping:
      # OpenList-STRM å®¹å™¨è·¯å¾„ -> Emby å®¹å™¨è·¯å¾„
      # "/data/strm": "/media/movies"

  # Jellyfin é…ç½®
  jellyfin:
    url: "http://jellyfin:8096"        # Jellyfin æœåŠ¡å™¨åœ°å€
    api_key: "your-jellyfin-api-key"   # Jellyfin API Key
    scan_mode: "full"                  # æ‰«ææ¨¡å¼: full=å…¨åº“æ‰«æ, path=è·¯å¾„æ‰«æ
    # è·¯å¾„æ˜ å°„é…ç½®ï¼ˆä»…åœ¨ scan_mode=path æ—¶éœ€è¦ï¼‰
    path_mapping:
      # OpenList-STRM å®¹å™¨è·¯å¾„ -> Jellyfin å®¹å™¨è·¯å¾„
      # "/data/strm": "/media/movies"
```

**é…ç½®è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | å¯é€‰å€¼ |
|------|------|--------|
| `enabled` | æ˜¯å¦å¯ç”¨é€šçŸ¥åŠŸèƒ½ | `true` / `false` |
| `type` | åª’ä½“æœåŠ¡å™¨ç±»å‹ | `emby` / `jellyfin` / `both` |
| `url` | åª’ä½“æœåŠ¡å™¨åœ°å€ | å¦‚ï¼š`http://emby:8096` |
| `api_key` | API å¯†é’¥ | åœ¨åª’ä½“æœåŠ¡å™¨è®¾ç½®ä¸­è·å– |
| `scan_mode` | æ‰«ææ¨¡å¼ | `full` / `path` |
| `path_mapping` | è·¯å¾„æ˜ å°„ï¼ˆå¯é€‰ï¼‰ | ä»…åœ¨ `path` æ¨¡å¼æ—¶éœ€è¦ |

**æ‰«ææ¨¡å¼è¯´æ˜**ï¼š

1. **å…¨å±€æ‰«ææ¨¡å¼ï¼ˆfullï¼‰** - æ¨è
   - è§¦å‘å®Œæ•´åª’ä½“åº“æ‰«æ
   - é…ç½®ç®€å•ï¼Œæ— éœ€è·¯å¾„æ˜ å°„
   - é€‚åˆå¤§å¤šæ•°åœºæ™¯
   - ç¼ºç‚¹ï¼šæ‰«ææ—¶é—´è¾ƒé•¿

2. **è·¯å¾„æ‰«ææ¨¡å¼ï¼ˆpathï¼‰** - é«˜çº§
   - ä»…æ‰«æ STRM æ–‡ä»¶æ‰€åœ¨è·¯å¾„
   - éœ€è¦é…ç½®è·¯å¾„æ˜ å°„
   - æ‰«æé€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°
   - è¦æ±‚ï¼šOpenList-STRM å’Œåª’ä½“æœåŠ¡å™¨çš„è·¯å¾„æ˜ å°„å¿…é¡»ä¸€è‡´

**è·¯å¾„æ˜ å°„ç¤ºä¾‹**ï¼š

```yaml
# åœºæ™¯ï¼šDocker å®¹å™¨é—´è·¯å¾„ä¸ä¸€è‡´
# OpenList-STRM å®¹å™¨:  /data/strm/Movies
# Emby å®¹å™¨:          /media/Movies

media_server:
  enabled: true
  type: "emby"
  emby:
    url: "http://emby:8096"
    api_key: "your-api-key"
    scan_mode: "path"
    path_mapping:
      "/data/strm": "/media"  # å°† /data/strm æ˜ å°„ä¸º /media
```

**è·å– API Key**ï¼š

- **Emby**ï¼šè®¾ç½® â†’ é«˜çº§ â†’ API å¯†é’¥ â†’ æ–°å»ºåº”ç”¨ç¨‹åº
- **Jellyfin**ï¼šè®¾ç½® â†’ API å¯†é’¥ â†’ æ·»åŠ  API å¯†é’¥

**é€šçŸ¥è§¦å‘æ¡ä»¶**ï¼š

- ä»…åœ¨æœ‰æ–‡ä»¶åˆ›å»ºæˆ–åˆ é™¤æ—¶è§¦å‘é€šçŸ¥
- å¦‚æœä»»åŠ¡æ²¡æœ‰å˜æ›´æ–‡ä»¶ï¼Œåˆ™è·³è¿‡é€šçŸ¥
- é€šçŸ¥å¤±è´¥ä¸å½±å“ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œä»…è®°å½•æ—¥å¿—

**Docker Compose é…ç½®ç¤ºä¾‹**ï¼š

```yaml
services:
  openlist-strm:
    image: konghanghang/openlist-strm:master
    volumes:
      - ./strm:/data/strm
    environment:
      - TZ=Asia/Shanghai

  emby:
    image: emby/embyserver
    volumes:
      - ./strm:/media  # æ³¨æ„ï¼šè·¯å¾„è¦ä¸ path_mapping å¯¹åº”
    environment:
      - TZ=Asia/Shanghai
```

## ğŸ› ï¸ æ„å»º

### ä»æºç æ„å»º

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/konghang/openlist-strm.git
cd openlist-strm

# æ„å»ºå‰ç«¯
cd web
npm install
npm run build
cd ..

# æ„å»ºåç«¯ï¼ˆå‰ç«¯å·²è‡ªåŠ¨åµŒå…¥ï¼‰
make build

# æˆ–è€…æ‰‹åŠ¨ç¼–è¯‘
go build -o bin/openlist-strm ./cmd/server
```

æ„å»ºåçš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«ï¼š
- Go åç«¯æœåŠ¡
- åµŒå…¥çš„ Vue 3 å‰ç«¯èµ„æº
- å•æ–‡ä»¶éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–ä¾èµ–

## ğŸ”Œ API æ¥å£

OpenList-STRM æä¾› RESTful API ä¾›å¤–éƒ¨ç¨‹åºè°ƒç”¨ã€‚

### ç”Ÿæˆ STRM æ–‡ä»¶

```bash
# ç”Ÿæˆæ‰€æœ‰æ˜ å°„
curl -X POST http://localhost:8080/api/generate \
  -H "Content-Type: application/json" \
  -d '{"mode": "incremental"}'

# ç”ŸæˆæŒ‡å®šè·¯å¾„
curl -X POST http://localhost:8080/api/generate \
  -H "Content-Type: application/json" \
  -d '{"path": "Movies", "mode": "full"}'
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
# è·å–ä»»åŠ¡åˆ—è¡¨
curl http://localhost:8080/api/tasks

# è·å–æŒ‡å®šä»»åŠ¡
curl http://localhost:8080/api/tasks/{task_id}
```

### è·å–é…ç½®

```bash
# è·å–æ‰€æœ‰è·¯å¾„æ˜ å°„é…ç½®
curl http://localhost:8080/api/configs
```

### Webhook æ¥å£

æ¥æ”¶å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ Alistã€ä¸‹è½½å™¨ï¼‰çš„é€šçŸ¥ï¼Œè‡ªåŠ¨è§¦å‘ STRM ç”Ÿæˆï¼š

```bash
curl -X POST http://localhost:8080/api/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "event": "file.upload",
    "path": "/media/movies/new-movie.mp4",
    "action": "add"
  }'
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "webhook received, generation triggered",
  "task_id": "uuid-string"
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- Alist Webhook é€šçŸ¥æ–‡ä»¶ä¸Šä¼ 
- ä¸‹è½½å™¨å®Œæˆåè‡ªåŠ¨è§¦å‘
- è‡ªåŠ¨åŒ–å·¥ä½œæµé›†æˆ

### API è®¤è¯

å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº† API Tokenï¼š

```bash
curl -X POST http://localhost:8080/api/generate \
  -H "Authorization: Bearer your-api-token" \
  -H "Content-Type: application/json" \
  -d '{"mode": "incremental"}'
```

### Trace ID æ—¥å¿—è¿½è¸ª

æ¯ä¸ªä»»åŠ¡æ‰§è¡Œéƒ½ä¼šç”Ÿæˆå”¯ä¸€çš„ Trace IDï¼ˆå– Task ID å‰ 8 ä½ï¼‰ï¼Œç”¨äºå…³è”æ‰€æœ‰ç›¸å…³æ—¥å¿—ï¼š

**ä»»åŠ¡çº§æ—¥å¿—**ï¼š
```
[TraceID: abc12345] Task started: mapping=Movies, mode=incremental, source=/media/movies
[TraceID: abc12345] Scanning source directory: /media/movies
[TraceID: abc12345] Found 150 video files to process
[TraceID: abc12345] Task COMPLETED: created=10, deleted=2, skipped=140, errors=0, duration=3.5s
```

**æ–‡ä»¶çº§æ—¥å¿—**ï¼ˆæ¯ä¸ªæ–‡ä»¶å¤„ç†çŠ¶æ€ï¼‰ï¼š
```
[TraceID: abc12345] âœ… CREATED: /media/movies/Movie1.mp4
[TraceID: abc12345] â­ï¸  SKIPPED: /media/movies/Movie2.mp4 (already exists)
[TraceID: abc12345] âŒ ERROR: /media/movies/Movie3.mp4 -> failed to get URL: timeout
```

**æŸ¥è¯¢ä»»åŠ¡æ—¥å¿—**ï¼š
```bash
# é€šè¿‡ Trace ID è¿‡æ»¤æ‰€æœ‰æ—¥å¿—
grep "TraceID: abc12345" logs/openlist-strm.log

# åªçœ‹ä»»åŠ¡çº§æ—¥å¿—ï¼ˆæ’é™¤æ–‡ä»¶çº§ï¼‰
grep "TraceID: abc12345" logs/openlist-strm.log | grep -v "CREATED\|SKIPPED\|ERROR:"

# åªçœ‹åˆ›å»ºçš„æ–‡ä»¶
grep "TraceID: abc12345" logs/openlist-strm.log | grep "âœ… CREATED"

# åªçœ‹é”™è¯¯çš„æ–‡ä»¶
grep "TraceID: abc12345" logs/openlist-strm.log | grep "âŒ ERROR"

# ç»Ÿè®¡å„çŠ¶æ€æ–‡ä»¶æ•°é‡
grep "TraceID: abc12345" logs/openlist-strm.log | grep -E "âœ…|â­ï¸|âŒ" | wc -l
```

**Trace ID æ¥æº**ï¼š
- API è°ƒç”¨ï¼šè¿”å›çš„ `task_id` å³ä¸ºå®Œæ•´ Trace ID
- Webhook è§¦å‘ï¼šå“åº”ä¸­çš„ `task_id` å³ä¸ºå®Œæ•´ Trace ID
- å®šæ—¶ä»»åŠ¡ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œä»æ—¥å¿—ä¸­æŸ¥çœ‹
- æ‰‹åŠ¨è§¦å‘ï¼šWeb UI ä»»åŠ¡åˆ—è¡¨ä¸­æ˜¾ç¤º

## ğŸ³ Docker éƒ¨ç½²

### æ‹‰å–é¢„æ„å»ºé•œåƒ

```bash
# ä» Docker Hub æ‹‰å–ï¼ˆå›½å†…æ¨èï¼‰
docker pull konghanghang/openlist-strm:master

# æˆ–ä» GitHub Container Registry æ‹‰å–
docker pull ghcr.io/konghanghang/openlist-strm:master
```

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir openlist-strm && cd openlist-strm

# ä¸‹è½½ç¤ºä¾‹é…ç½®
wget https://raw.githubusercontent.com/konghanghang/openlist-strm/master/configs/config.example.yaml -O config.yaml

# ç¼–è¾‘é…ç½®ï¼ˆä¸»è¦é…ç½® Alist URL å’Œ Tokenï¼‰
vim config.yaml

# åˆ›å»º docker-compose.yml å¹¶å¯åŠ¨
docker-compose up -d
```

**docker-compose.yml ç¤ºä¾‹ï¼š**

```yaml
services:
  openlist-strm:
    image: konghanghang/openlist-strm:master
    container_name: openlist-strm
    restart: unless-stopped
    ports:
      - 8080:8080
    volumes:
      - ./config.yaml:/app/configs/config.yaml:ro
      - ./data:/app/data
      - ./strm:/mnt/strm
    environment:
      - TZ=Asia/Shanghai
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f openlist-strm

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker logs --tail 100 openlist-strm

# æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
docker logs -t openlist-strm
```

**æ³¨æ„**ï¼šé»˜è®¤é…ç½®æ—¥å¿—è¾“å‡ºåˆ° stdoutï¼Œé€šè¿‡ `docker logs` æŸ¥çœ‹å³å¯ã€‚å¦‚éœ€æ–‡ä»¶æ—¥å¿—ï¼Œè¯·åœ¨é…ç½®ä¸­è®¾ç½® `log.file` å¹¶æŒ‚è½½ `/app/logs` ç›®å½•ã€‚

### ä½¿ç”¨ Docker

```bash
# è¿è¡Œå®¹å™¨
docker run -d \
  --name openlist-strm \
  -p 8080:8080 \
  -v $(pwd)/config.yaml:/app/configs/config.yaml:ro \
  -v $(pwd)/data:/app/data \
  -v /path/to/strm:/mnt/strm \
  -e TZ=Asia/Shanghai \
  konghanghang/openlist-strm:master
```

è¯¦ç»†éƒ¨ç½²æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š[deployments/README.md](./deployments/README.md)

## ğŸ“¦ æ¨èé…å¥—å·¥å…·

### 302 é‡å®šå‘ä»£ç†

- **[MediaWarp](https://github.com/AkimioJR/MediaWarp)** â­â­â­â­â­
  - æ”¯æŒ Emby/Jellyfin STRM 302 é‡å®šå‘
  - æ”¯æŒ Alist ç­¾åã€CDN åˆ‡æ¢
  - å®Œç¾é…åˆ alist_path æ¨¡å¼ä½¿ç”¨
  - æ¨èæ­é…ä½¿ç”¨

### Emby æ’ä»¶

- **[Strm Assistant (ç¥åŒ»åŠ©æ‰‹)](https://github.com/sjtuross/StrmAssistant)** â­â­â­â­â­
  - ä¼˜åŒ– STRM æ’­æ”¾é€Ÿåº¦
  - ä¸­æ–‡æœç´¢å’Œæ’åº
  - STRM ç”¨æˆ·å¿…å¤‡

### åˆ®å‰Šå·¥å…·

- **[MediaElch](https://www.mediaelch.de/)** - è½»é‡çº§ï¼Œå…è´¹
- **[tinyMediaManager](https://www.tinymediamanager.org/)** - ä¸“ä¸šï¼Œå‡†ç¡®ç‡é«˜

### å­—å¹•å·¥å…·

- **[ChineseSubFinder](https://github.com/ChineseSubFinder/ChineseSubFinder)** - ä¸­æ–‡å­—å¹•è‡ªåŠ¨ä¸‹è½½

## ğŸ“š æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š
- [é¡¹ç›®éœ€æ±‚æ–‡æ¡£ (PRD)](./docs/PRD.md)
- [æµ‹è¯•è®¡åˆ’æ–‡æ¡£ (TESTING)](./docs/TESTING.md)
- [é…ç½®æ–‡ä»¶ç¤ºä¾‹](./configs/config.example.yaml)
- [Docker éƒ¨ç½²æŒ‡å—](./deployments/README.md)
- [Webhook é›†æˆæŒ‡å—](./deployments/WEBHOOK.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Alist](https://alist.nn.ci/) - ä¼˜ç§€çš„æ–‡ä»¶åˆ—è¡¨ç¨‹åº
- [tefuirZ/alist-strm](https://github.com/tefuirZ/alist-strm) - é¡¹ç›®çµæ„Ÿæ¥æº

---

**ğŸ¤– Powered by Go | Made with â¤ï¸**
